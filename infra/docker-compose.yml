version: "3.9"
services:
  provider:
    build:
      context: ./apps/provider_analystco
      dockerfile: Dockerfile
    container_name: eldin_provider
    ports:
      - "8001:8001"
    environment:
      - PROVIDER_NAME=AnalystCo
      - DATA_DIR=/app/data
      - HOST=http://provider:8001
    volumes:
      - ../data/provider_analystco:/app/data
    networks: [eldinnet]

  gateway:
    build:
      context: ./apps/gateway
      dockerfile: Dockerfile
    container_name: eldin_gateway
    ports:
      - "8000:8000"
    environment:
      - PROVIDER_BASE=http://provider:8001
      - AUDIT_LOG=/app/data/logs/audit.jsonl
      - EXCERPT_PER_SECTION=600
      - EXCERPT_TOTAL_CAP=1200
      - CORS_ORIGIN=http://localhost:3000
    volumes:
      - ../data:/app/data
    depends_on: [provider]
    networks: [eldinnet]

  web:
    build:
      context: ./apps/web
      dockerfile: Dockerfile
    container_name: eldin_web
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_GATEWAY=http://localhost:8000
    depends_on: [gateway]
    networks: [eldinnet]

networks:
  eldinnet: {}